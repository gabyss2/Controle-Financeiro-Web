
import React, { useEffect, useState } from "react"; import { View, TextInput, FlatList, Text, Pressable, Alert } from "react-native"; import { supabase } from "../lib/supabase"; import type { Category } from "../types"; import { Button } from "./UI";
export default function CategoryEditor() { const [list, setList] = useState<Category[]>([]); const [name, setName] = useState(""); const [type, setType] = useState<"receita" | "despesa">("despesa"); async function load() { const { data, error } = await supabase.from("categories").select("*").order("name"); if (error) Alert.alert("Erro", error.message); else setList((data ?? []) as Category[]); }
  async function add() { if (!name.trim()) return; const { error } = await supabase.from("categories").insert({ name: name.trim(), type }); if (error) Alert.alert("Erro", error.message); setName(""); load(); }
  async function rename(cat: Category) { const newName = prompt("Novo nome para " + cat.name) ?? ""; if (!newName.trim()) return; const { error } = await supabase.from("categories").update({ name: newName.trim() }).eq("id", cat.id); if (error) Alert.alert("Erro", error.message); load(); }
  async function archive(cat: Category) { const { error } = await supabase.from("categories").update({ archived: true }).eq("id", cat.id); if (error) Alert.alert("Erro", error.message); load(); }
  useEffect(() => { load(); }, []);
  return (<View style={{ gap: 10 }}><Text style={{ fontWeight: "700" }}>Categorias ({type})</Text><View style={{ flexDirection: "row", gap: 8 }}><Button label="Despesa" onPress={() => setType("despesa")} variant={type === "despesa" ? "primary" : "ghost"} /><Button label="Receita" onPress={() => setType("receita")} variant={type === "receita" ? "primary" : "ghost"} /></View><View style={{ flexDirection: "row", gap: 8 }}><TextInput placeholder="Nova categoria" value={name} onChangeText={setName} style={{ flex: 1, borderWidth: 1, padding: 10, borderRadius: 8 }} /><Button label="Adicionar" onPress={add} /></View><FlatList data={list.filter((c) => c.type === type && !c.archived)} keyExtractor={(i) => i.id} renderItem={({ item }) => (<View style={{ flexDirection: "row", justifyContent: "space-between", padding: 10, borderWidth: 1, borderRadius: 8, marginTop: 6 }}><Text>{item.name}</Text><View style={{ flexDirection: "row", gap: 12 }}><Pressable onPress={() => rename(item)}><Text style={{ color: "#1f7a8c" }}>Renomear</Text></Pressable><Pressable onPress={() => archive(item)}><Text style={{ color: "#a00" }}>Arquivar</Text></Pressable></View></View>)} /></View>); }
